<!DOCTYPE html>
<html>
<head>
    <title>User Settings</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='res/core.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='themes/' ~ theme ~ '.css') }}">
    <script src="{{ url_for('static', filename='res/core.js') }}"></script>
</head>
<body>
    <div class="page-container">
        <div class="header">
            <h1>Settings</h1>
        </div>
        <div class="content-box" style="max-width: 600px; margin: 0 auto;">
            <h3>Edit Profile: {{ target_user }}</h3>

            {% if target_data.level == 0 and target_user == username %}
            <div class="alert alert-warning">
                <strong>Guest Account:</strong> Email not verified.
                <form action="/upgrade_account" method="POST" style="margin-top: 10px;">
                    <button type="submit" class="btn btn-primary btn-sm">Verify Now</button>
                </form>
            </div>
            {% endif %}

            <form method="POST">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" name="new_username" class="input" value="{{ target_user }}" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" class="input" value="{{ target_data.email }}" required>
                </div>
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" name="password" class="input" placeholder="Leave blank to keep current">
                </div>
                <div class="form-group">
                    <label>Theme</label>
                    <select name="theme" class="input">
                        {% for t in themes %}
                        <option value="{{ t }}" {% if target_data.theme == t %}selected{% endif %}>{{ t }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group" style="margin: 20px 0;">
                    <label class="switch">
                        <input type="checkbox" name="2fa" {% if target_data.get('2fa', True) %}checked{% endif %}>
                        <span class="slider"></span>
                    </label>
                    <span style="vertical-align: middle; font-weight: bold;">Enable Two-Factor Authentication</span>
                </div>

                {% if level >= 2 %}
                <div class="form-group">
                    <label>Access Level (Admin Override)</label>
                    <input type="number" name="level" class="input" value="{{ target_data.level }}">
                </div>
                {% endif %}

                <button type="submit" class="btn btn-primary btn-block">Save Changes</button>
            </form>
            <div class="divider"></div>
            <button onclick="openModal('deleteConfirmModal')" class="btn btn-danger btn-block">Delete Account</button>
        </div>
    </div>

    <div id="deleteConfirmModal" class="modal-wrapper">
        <div class="modal-content" style="max-width: 400px; height: auto;">
            <div class="modal-header"><h3>Warning</h3></div>
            <div class="modal-body"><p>Are you sure you want to delete your account? All data will be lost permanently.</p></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('deleteConfirmModal')">Cancel</button>
                <button class="btn btn-danger" onclick="initDeleteAccount()">Continue</button>
            </div>
        </div>
    </div>

    <div id="deleteOtpModal" class="modal-wrapper">
        <div class="modal-content" style="max-width: 400px; height: auto;">
            <div class="modal-header"><h3>Security Verification</h3></div>
            <div class="modal-body">
                <label>Remember once you verifty your data will be removed instantly.<br>To remove your account.<br> Please enter your verification code. The code has been sent to your email.</label>
                <input type="text" id="delete_otp_input" class="input" style="text-align: center; font-size: 1.5rem; letter-spacing: 5px; text-transform: uppercase;">
                <label> </label>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('deleteOtpModal')">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDeleteAccount()">Verify & Delete</button>
            </div>
        </div>
    </div>

    <div id="loadingOverlay" class="modal-wrapper" style="background: rgba(0,0,0,0.8); z-index: 9999;">
        <div style="color: white; font-size: 1.5rem; font-weight: bold;">Processing...</div>
    </div>
</body>
</html>