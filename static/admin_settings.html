<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='res/core.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='themes/' ~ theme ~ '.css') }}">
    <script src="{{ url_for('static', filename='res/core.js') }}"></script>
</head>
<body>
    <div class="page-container">
        <div class="header">
            <h1>System Administration</h1>
            <div class="badge badge-sys">ADMIN</div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>System Status</h3>
                <div class="stat-number">{{ (db_usage / 1024) | round(2) }} KB</div>
                <div class="stat-label">Database Size</div>
            </div>
            <div class="card">
                <h3>Configuration</h3>
                <textarea id="sys-config" class="input" style="height:100px; font-family:monospace;">{{ config | tojson(indent=4) }}</textarea>
                <button class="btn btn-primary btn-sm" onclick="saveSysConfig()" style="margin-top:10px;">Save Config</button>
            </div>
        </div>

        <div class="card">
            <h3>User Management</h3>
            <div style="background: var(--p-bg-surface-1); padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <input type="text" id="new-user-name" class="input" placeholder="Username" style="flex:1;">
                    <input type="email" id="new-user-email" class="input" placeholder="Email" style="flex:1;">
                    <input type="password" id="new-user-pass" class="input" placeholder="Password" style="flex:1;">
                    <select id="new-user-level" class="input" style="width: auto;">
                        <option value="0">Guest (0)</option>
                        <option value="1">User (1)</option>
                        <option value="2">Admin (2)</option>
                    </select>
                    <button class="btn btn-primary" onclick="createUser()">Add User</button>
                </div>
            </div>

            <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                <input type="text" id="user-search" class="input" placeholder="Search users..." onkeyup="filterUsers()" style="flex:2;">
                <select id="level-filter" class="input" onchange="filterUsers()" style="flex:1;">
                    <option value="">All Levels</option>
                    <option value="0">Level 0</option>
                    <option value="1">Level 1</option>
                    <option value="2">Level 2</option>
                </select>
            </div>

            <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                <button class="btn btn-danger btn-sm" onclick="batchDelete()">Delete Selected</button>
                <button class="btn btn-secondary btn-sm" onclick="batchSetLevel(0)">Set Guest</button>
                <button class="btn btn-secondary btn-sm" onclick="batchSetLevel(1)">Set User</button>
                <button class="btn btn-secondary btn-sm" onclick="batchSetLevel(2)">Set Admin</button>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 40px;"><input type="checkbox" id="master-select" onclick="toggleAll(this)"></th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Level</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u, data in users_list.items() %}
                    <tr class="user-row">
                        <td><input type="checkbox" class="user-checkbox" value="{{ u }}"></td>
                        <td class="user-name"><strong>{{ u }}</strong></td>
                        <td class="user-email">{{ data.email }}</td>
                        <td class="user-level"><span class="badge badge-info">{{ data.level }}</span></td>
                        <td><a href="user_settings.html?edit_user={{ u }}&content=1" class="btn btn-secondary btn-sm">Edit</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Themes</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="file" id="theme-upload" accept=".css" class="input">
                    <button class="btn btn-primary btn-sm" onclick="uploadTheme()">Upload</button>
                </div>
                <ul class="theme-select-list">
                    {% for t in themes %}
                    <li class="theme-option">
                        <span>{{ t }}.css</span>
                        {% if t != 'default' %}
                        <button class="btn btn-danger btn-sm" onclick="deleteTheme('{{ t }}')">Delete</button>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            <div class="card">
                <h3>System Logs</h3>
                <div id="log-container">
                    {% if logs %}
                        {% for log in logs %}
                        <div class="log-entry">{{ log }}</div>
                        {% endfor %}
                    {% else %}
                        <div class="text-muted">No logs available.</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</body>
</html>